---
import type { Language } from "../i18n/config"
import { t, getOtherLanguage } from "../i18n/utils"
import { getCollection } from "astro:content"

interface Props {
  currentLang: Language
  translationId?: string
}

const { currentLang, translationId } = Astro.props

let translatedPost = null

if (translationId) {
  const otherLang = getOtherLanguage(currentLang)
  const allPosts = await getCollection("posts")

  // Find the post with the same translationId in the other language
  translatedPost = allPosts.find(
    (post) =>
      post.data.translationId === translationId && post.data.lang === otherLang,
  )
}
---

{
  translatedPost && (
    <div class="translation-link">
      <a href={`/${translatedPost.data.lang}/posts/${translatedPost.slug.replace(/^(en|mn)\//, "")}/`}>
        {currentLang === "en"
          ? t("post.read_in_mongolian", currentLang)
          : t("post.read_in_english", currentLang)}
      </a>
    </div>
  )
}

<style>
  .translation-link {
    margin: 2rem 0;
    padding: 1rem;
    background: var(--bg-secondary, #f5f5f5);
    border-radius: 0.5rem;
  }

  .translation-link a {
    color: var(--text-primary, #333);
    text-decoration: none;
    font-weight: 500;
    transition: opacity 0.2s;
  }

  .translation-link a:hover {
    opacity: 0.7;
  }

  @media (prefers-color-scheme: dark) {
    .translation-link {
      background: var(--bg-secondary, #2a2a2a);
    }

    .translation-link a {
      color: var(--text-primary, #e0e0e0);
    }
  }
</style>
